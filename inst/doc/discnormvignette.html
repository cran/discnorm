<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Njål Foldnes and Steffen Grønneberg" />

<meta name="date" content="2022-03-22" />

<title>Discnorm: Detecting and adjusting for underlying non-normality in ordinal datasets</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Discnorm: Detecting and adjusting for underlying non-normality in ordinal datasets</h1>
<h4 class="author">Njål Foldnes and Steffen Grønneberg</h4>
<h4 class="date">2022-03-22</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(discnorm )</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(lavaan)</span></code></pre></div>
<p>The discnorm package uses bootstrapping to help determine whether the commonly assumed normality assumption is tenable for an ordinal dataset. Researchers wanting to proceed with ordinal SEM based on polychoric correlations should first to check that the normalit copula assumption is not violated. Also, if the normality assumption is tenable, researchers may specify other marginal distributions using catLSadjust().</p>
<div id="example-of-boottest" class="section level2">
<h2>Example of bootTest()</h2>
<p>The procedure is named bootTest() and operates on an ordinal dataset and returns a p-value associated with the null-hypothesis of underlying normality. Let us first use the test for a dataset that is produced by underlying normality.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#let us discretize an underlying normal vector</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># with moderate correlation </span></span>
<span id="cb2-3"><a href="#cb2-3"></a>rho &lt;-<span class="st"> </span><span class="fl">0.3</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>Sigma &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="dv">5</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a>Sigma[Sigma <span class="op">!=</span><span class="dv">1</span>] &lt;-<span class="st"> </span>rho</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a>norm.sample  &lt;-<span class="st"> </span>MASS<span class="op">::</span><span class="kw">mvrnorm</span>(<span class="dt">n=</span><span class="dv">200</span>, <span class="dt">mu=</span><span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="dt">Sigma=</span>Sigma)</span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co"># let us discretize into 4 categories</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>disc.sample &lt;-<span class="st"> </span><span class="kw">apply</span>(norm.sample, <span class="dv">2</span>, cut,   <span class="dt">breaks=</span><span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">-1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">Inf</span>), <span class="dt">labels=</span><span class="ot">FALSE</span>)</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#check for underlying normality</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>pvalue &lt;-<span class="st"> </span><span class="kw">bootTest</span>(disc.sample, <span class="dt">B=</span><span class="dv">500</span>)</span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt; Progress 0% 10% 20% 30% 40% 50% 60% 70% 80% 90% 100%</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="kw">print</span>(pvalue)</span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt; [1] 0.918</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co"># we have no evidence against the null hypothesis of underlying normality</span></span></code></pre></div>
<p>And let us discretize a non-normal dataset</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>nonnorm.sample &lt;-<span class="st"> </span><span class="kw">data.frame</span>(norm.sample[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], norm.sample[,<span class="dv">1</span>]<span class="op">*</span>norm.sample[,<span class="dv">2</span>])</span>
<span id="cb3-2"><a href="#cb3-2"></a>disc.sample2 &lt;-<span class="st"> </span><span class="kw">apply</span>(nonnorm.sample, <span class="dv">2</span>, cut, <span class="dt">breaks=</span><span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">-1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">Inf</span>), <span class="dt">labels=</span><span class="ot">FALSE</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>pvalue &lt;-<span class="st"> </span><span class="kw">bootTest</span>(disc.sample2, <span class="dt">B=</span><span class="dv">500</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt; Progress 0% 10% 20% 30% 40% 50% 60% 70% 80% 90% 100%</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">print</span>(pvalue)</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># rejected!</span></span></code></pre></div>
<p>The procedure is fully described in <span class="citation">Foldnes and Grønneberg (2019)</span></p>
</div>
<div id="example-of-adjusted-polychoric-correlation-catlsadj" class="section level2">
<h2>Example of adjusted polychoric correlation: catLSadj()</h2>
<p>First we generate a large dataset with non-normal marginals by transforming the marginals of a normal dataset</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>shape=<span class="st"> </span><span class="dv">2</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>scale =<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(shape)</span>
<span id="cb4-3"><a href="#cb4-3"></a>m1 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">F=</span><span class="cf">function</span>(x) <span class="kw">pchisq</span>(x, <span class="dt">df=</span><span class="dv">1</span>), <span class="dt">qF=</span><span class="cf">function</span>(x) <span class="kw">qchisq</span>(x, <span class="dt">df=</span><span class="dv">1</span>), <span class="dt">sd=</span><span class="kw">sqrt</span>(<span class="dv">2</span>))</span>
<span id="cb4-4"><a href="#cb4-4"></a>G3 &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">pgamma</span>(x<span class="op">+</span>shape<span class="op">*</span>scale, <span class="dt">shape=</span>shape, <span class="dt">scale=</span>scale)</span>
<span id="cb4-5"><a href="#cb4-5"></a>G3flip &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="dv">1</span><span class="op">-</span><span class="st"> </span><span class="kw">G3</span>(<span class="op">-</span>x)</span>
<span id="cb4-6"><a href="#cb4-6"></a>qG3 &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">qgamma</span>(x, <span class="dt">shape=</span>shape, <span class="dt">scale=</span>scale)<span class="op">-</span>shape<span class="op">*</span>scale</span>
<span id="cb4-7"><a href="#cb4-7"></a>qG3flip &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="op">-</span><span class="kw">qG3</span>(<span class="dv">1</span><span class="op">-</span>x)</span>
<span id="cb4-8"><a href="#cb4-8"></a>marginslist &lt;-<span class="st"> </span><span class="kw">list</span>(m1, <span class="kw">list</span>(<span class="dt">F=</span>G3, <span class="dt">qF=</span>qG3), <span class="kw">list</span>(<span class="dt">F=</span>G3flip, <span class="dt">qF=</span>qG3flip))</span>
<span id="cb4-9"><a href="#cb4-9"></a>                    </span>
<span id="cb4-10"><a href="#cb4-10"></a>Sigma &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="dv">3</span>)</span>
<span id="cb4-11"><a href="#cb4-11"></a>Sigma[Sigma<span class="op">==</span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>Sigma</span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; [1,]  1.0  0.5  0.5</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; [2,]  0.5  1.0  0.5</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt; [3,]  0.5  0.5  1.0</span></span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb4-19"><a href="#cb4-19"></a>norm.data &lt;-<span class="st"> </span>MASS<span class="op">::</span><span class="kw">mvrnorm</span>(<span class="dv">10</span><span class="op">^</span><span class="dv">5</span>, <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">3</span>), Sigma)</span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="kw">colnames</span>(norm.data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x1&quot;</span>, <span class="st">&quot;x2&quot;</span>, <span class="st">&quot;x3&quot;</span>)</span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#With normal marginals, the correlation matrix is (approximately)</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#Sigma.</span></span>
<span id="cb4-23"><a href="#cb4-23"></a></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co">#Transform the marginals to follow the elements in marginslist:</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>nonnorm.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x1=</span>marginslist[[<span class="dv">1</span>]]<span class="op">$</span><span class="kw">qF</span>(<span class="kw">pnorm</span>(norm.data[, <span class="dv">1</span>])), </span>
<span id="cb4-26"><a href="#cb4-26"></a>                     <span class="dt">x2=</span>marginslist[[<span class="dv">2</span>]]<span class="op">$</span><span class="kw">qF</span>(<span class="kw">pnorm</span>(norm.data[, <span class="dv">2</span>])),</span>
<span id="cb4-27"><a href="#cb4-27"></a>                     <span class="dt">x3=</span>marginslist[[<span class="dv">3</span>]]<span class="op">$</span><span class="kw">qF</span>(<span class="kw">pnorm</span>(norm.data[, <span class="dv">3</span>])))</span>
<span id="cb4-28"><a href="#cb4-28"></a></span>
<span id="cb4-29"><a href="#cb4-29"></a><span class="kw">cor</span>(nonnorm.data)</span>
<span id="cb4-30"><a href="#cb4-30"></a><span class="co">#&gt;           x1        x2        x3</span></span>
<span id="cb4-31"><a href="#cb4-31"></a><span class="co">#&gt; x1 1.0000000 0.4389354 0.3549677</span></span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="co">#&gt; x2 0.4389354 1.0000000 0.4256547</span></span>
<span id="cb4-33"><a href="#cb4-33"></a><span class="co">#&gt; x3 0.3549677 0.4256547 1.0000000</span></span></code></pre></div>
<p>Next we fit both the normal and the non-normal datasets to a factor model (which fits perfectly to both sets), and look at factor loading parameters</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">head</span>(<span class="kw">standardizedsolution</span>(<span class="kw">cfa</span>(<span class="st">&quot;F=~ x1+x2+x3&quot;</span>, norm.data)),<span class="dv">3</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt;   lhs op rhs est.std    se       z pvalue ci.lower ci.upper</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt; 1   F =~  x1   0.710 0.002 286.201      0    0.705    0.715</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt; 2   F =~  x2   0.707 0.002 284.859      0    0.702    0.712</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt; 3   F =~  x3   0.710 0.002 286.078      0    0.705    0.715</span></span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="kw">head</span>(<span class="kw">standardizedsolution</span>(<span class="kw">cfa</span>(<span class="st">&quot;F=~ x1+x2+x3&quot;</span>, nonnorm.data)),<span class="dv">3</span>)</span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt;   lhs op rhs est.std    se       z pvalue ci.lower ci.upper</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; 1   F =~  x1   0.605 0.003 191.004      0    0.599    0.611</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; 2   F =~  x2   0.725 0.003 219.829      0    0.719    0.732</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; 3   F =~  x3   0.587 0.003 185.940      0    0.581    0.593</span></span></code></pre></div>
<p>Then we discretize the non-normal dataset and confirm that the strongly polychoric correlations are strongly biased</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>disc.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x1=</span><span class="kw">cut</span>(nonnorm.data[, <span class="dv">1</span>], <span class="dt">breaks=</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="ot">Inf</span>), <span class="dt">labels=</span><span class="ot">FALSE</span>), </span>
<span id="cb6-2"><a href="#cb6-2"></a>                   <span class="dt">x2=</span> <span class="kw">cut</span>(nonnorm.data[, <span class="dv">2</span>], <span class="dt">breaks=</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="fl">-.7</span>, <span class="dv">0</span>,<span class="dv">1</span>, <span class="ot">Inf</span>), <span class="dt">labels=</span><span class="ot">FALSE</span>),</span>
<span id="cb6-3"><a href="#cb6-3"></a>                   <span class="dt">x3=</span><span class="kw">cut</span>(nonnorm.data[, <span class="dv">3</span>], <span class="dt">breaks=</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">-1</span>, <span class="dv">0</span>,<span class="dv">1</span>, <span class="ot">Inf</span>), <span class="dt">labels=</span><span class="ot">FALSE</span>))</span>
<span id="cb6-4"><a href="#cb6-4"></a></span>
<span id="cb6-5"><a href="#cb6-5"></a>lavaan<span class="op">::</span><span class="kw">lavCor</span>(disc.data, <span class="dt">ordered=</span><span class="kw">colnames</span>(disc.data))</span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt;    x1    x2    x3   </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt; x1 1.000            </span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; x2 0.503 1.000      </span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; x3 0.506 0.503 1.000</span></span></code></pre></div>
<p>Next, compute the adjusted correlations and the associated standard error. Confirm that the correlations are close to those in the original non-normal dataset:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>adjusted &lt;-<span class="st"> </span><span class="kw">catLSadj</span>(disc.data, marginslist, <span class="dt">verbose=</span>T )</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co">#&gt; Standard deviation approximated to be: 1 </span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; Standard deviation approximated to be: 1 </span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt;    x1    x2    x3   </span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; x1 1.000            </span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; x2 0.503 1.000      </span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; x3 0.506 0.503 1.000</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt;    x1    x2    x3   </span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; x1 1.000            </span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; x2 0.440 1.000      </span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; x3 0.357 0.427 1.000</span></span>
<span id="cb7-12"><a href="#cb7-12"></a></span>
<span id="cb7-13"><a href="#cb7-13"></a></span>
<span id="cb7-14"><a href="#cb7-14"></a>adjusted[[<span class="dv">1</span>]]</span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt;    x1    x2    x3   </span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt; x1 1.000            </span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt; x2 0.440 1.000      </span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&gt; x3 0.357 0.427 1.000</span></span></code></pre></div>
<p>Running conventional ordinal factor analysis leads to biased factor loadings:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">head</span>(<span class="kw">standardizedsolution</span>(fcat &lt;-<span class="st"> </span><span class="kw">cfa</span>(<span class="st">&quot;F=~ x1+x2+x3&quot;</span>, disc.data, <span class="dt">ordered=</span><span class="kw">colnames</span>(disc.data))),<span class="dv">3</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">#&gt;   lhs op rhs est.std    se       z pvalue ci.lower ci.upper</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#&gt; 1   F =~  x1   0.712 0.003 221.553      0    0.705    0.718</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">#&gt; 2   F =~  x2   0.707 0.003 225.835      0    0.701    0.713</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt; 3   F =~  x3   0.711 0.003 226.119      0    0.705    0.717</span></span></code></pre></div>
<p>These parameter estimates are close to the parameters of the continuous model for normal data, and not to the model parameters obtained from the discretized non-normal dataset To get consistent estimates of these parameters we need to use the adjusted polychoric correlation.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a></span>
<span id="cb9-2"><a href="#cb9-2"></a>sample.th   &lt;-<span class="st"> </span><span class="kw">lavInspect</span>(fcat, <span class="st">&quot;sampstat&quot;</span>)<span class="op">$</span>th</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">attr</span>(sample.th, <span class="st">&quot;th.idx&quot;</span>) &lt;-<span class="st"> </span><span class="kw">lavInspect</span>(fcat, <span class="st">&quot;th.idx&quot;</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#the asymptotic covariance matrix of the adjusted polychorics: </span></span>
<span id="cb9-5"><a href="#cb9-5"></a>gamma.adj &lt;-<span class="st"> </span>adjusted[[<span class="dv">2</span>]]</span>
<span id="cb9-6"><a href="#cb9-6"></a>WLS.V.new &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span><span class="op">/</span><span class="kw">diag</span>(gamma.adj))</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>fcat.adj  &lt;-<span class="st"> </span><span class="kw">cfa</span>(<span class="st">&quot;F=~ x1+x2+x3&quot;</span>, <span class="dt">sample.cov=</span>adjusted[[<span class="dv">1</span>]],</span>
<span id="cb9-9"><a href="#cb9-9"></a>                  <span class="dt">sample.nobs=</span><span class="kw">nrow</span>(disc.data),  <span class="dt">sample.th=</span>sample.th,</span>
<span id="cb9-10"><a href="#cb9-10"></a>                  <span class="dt">NACOV =</span> gamma.adj, <span class="dt">WLS.V=</span>WLS.V.new)</span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="kw">head</span>(<span class="kw">standardizedsolution</span>(fcat.adj), <span class="dv">3</span>)</span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt;   lhs op rhs est.std    se       z pvalue ci.lower ci.upper</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt; 1   F =~  x1   0.607 0.003 224.011      0    0.602    0.612</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt; 2   F =~  x2   0.725 0.003 224.485      0    0.719    0.731</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt; 3   F =~  x3   0.589 0.002 237.887      0    0.584    0.593</span></span></code></pre></div>
<p>Closely matches the model parameters obtained with the non-normal dataset</p>
<p>The procedure is fully described in <span class="citation">Grønneberg and Foldnes (2022)</span></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-fold1">
<p>Foldnes, N, and S Grønneberg. 2019. “Pernicious Polychorics: The Impact and Detection of Underlying Non-Normality.” <em>Structural Equation Modeling: A Multidisciplinary Journal</em>.</p>
</div>
<div id="ref-fold2">
<p>Grønneberg, S, and N Foldnes. 2022. “Factor Analyzing Ordinal Items Requires Substantive Knowledge of Response Marginals.” <em>Psychological Methods</em>.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
